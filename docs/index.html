<!DOCTYPE html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script>
class ProblemStrategy {
    firstNumber;
    secondNumber;

    constructor() {
    }

    getDisplay() {
        return "This problem strategy doesn't have a display yet";
    }

    checkAnswer(answerText) {
        return false;
    }
}

class SubtractionStrategy extends ProblemStrategy {
    constructor() {
        super();
        this.firstNumber = randInt(2,13);
        this.secondNumber = randInt(Math.max(this.firstNumber-5,0),this.firstNumber);
    }

    getDisplay() {
        return this.firstNumber+" - "+this.secondNumber;
    }

    checkAnswer(answerText) {
        return answerText === (this.firstNumber - this.secondNumber).toString();
    }
}

class AdditionStrategy extends ProblemStrategy {

    constructor() {
        super();
        this.firstNumber = randInt(2,10);
        this.secondNumber = randInt(Math.max(this.firstNumber+2,5),13)-this.firstNumber;
    }

    getDisplay() {
        return  this.firstNumber+" + "+this.secondNumber;
    }

    checkAnswer(answerText) {
        return answerText === (this.firstNumber + this.secondNumber).toString();
    }
}


class SillyHundredStrategy extends SubtractionStrategy {
    constructor() {
        super();
        this.firstNumber = 100 * randInt(1,5);
        this.secondNumber = this.firstNumber;
    }
}


function randInt(beginning,end) {
    return  beginning+Math.floor(Math.random()*(end-beginning));
}
function newProblem() {
    if(Math.random()<0.1) {
       problemStrategy = new SillyHundredStrategy();
    } else if(Math.random()>0.5) {
       problemStrategy = new SubtractionStrategy();
    } else {
       problemStrategy = new AdditionStrategy();
    }

    var firstNumberDiv = document.getElementById('firstNumber');
    firstNumberDiv.textContent = problemStrategy.getDisplay();
    console.log("New Problem: "+firstNumberDiv.textContent);
    var answerDiv = document.getElementById('answer');
    answerDiv.textContent = "";
    isRight = false;
    if(goalMet) {
        var numRightDiv = document.getElementById('numRight');
        numRightDiv.textContent = "";
    }
    clear();
}
function clear() {
    var d = new Date();
    lastClear = d.getTime();
}

var problemStrategy;
var numRightGoal = 30;

var numRight = 0;
var goalMet = false;
var isRight = false;

var lastClear;

window.onload = function() {
    newProblem();
}

document.onkeyup = function(event) {
    console.log("key:"+event.key);
    var answerDiv = document.getElementById('answer');
    var numRightDiv = document.getElementById('numRight');
    if(event.key === "Backspace") {
       var d = new Date();
       let tryClear = d.getTime();
       console.log("Time since last clear:"+(tryClear - lastClear));

       if((tryClear - lastClear) <2000) {
           clear();
           answerDiv.textContent = "Please think for two seconds between guesses";
       } else {
           clear();
           answerDiv.textContent = "";
       }
    } else if(event.key === "Enter") {
     if(!isRight) {
           answer.textContent = "Keep trying!";
       } else {
           newProblem();
       }
    } else {
       answerDiv.append(event.key);
    }
    if(!isRight && problemStrategy.checkAnswer(answerDiv.textContent)) {
        answerDiv.textContent = "You got it right!";
        numRight += 1;
        isRight = true;
        numRightDiv.textContent = "# right: "+((numRight-1)%numRightGoal+1);
        if(numRight > 0 && numRight % numRightGoal == 0 && !goalMet) {
            answerDiv.textContent = "You got "+numRightGoal+" right! Good work!";
            goalMet = true;
        } else {
            goalMet = false;
        }
    }
};

</script>
<style>
* {
   color:purple;
   font-weight: bold;
}
body {
   font-size: 2em;
   margin: 5em;
}
</style>
</head>
<body>
<h1>Hi! Welcome to Purple Keys!</h1>
<p id="firstNumber">Something is broken. Ask Daddy for help.</p>
<p><span id="answer"></span>&nbsp;</p>
<p id="numRight"></p>
</body>
